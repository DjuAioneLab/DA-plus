<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>지도</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=6lcb5pk9bx"></script>
    <script type="text/javascript" src="https://rawgit.com/jawj/OverlappingMarkerSpiderfier-Leaflet/master/oms.min.js"></script>
    <style>
        #map {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        var mapOptions = {
            center: new naver.maps.LatLng(37.5665, 126.9780),
            zoom: 14,
            mapTypeId: naver.maps.MapTypeId.NORMAL
        };

        var map = new naver.maps.Map('map', mapOptions);


        function loadCSV(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    callback(xhr.responseText);
                }
            };
            xhr.send();
        }


        function parseCSVAndCreateMarkers(data) {
            var lines = data.split('\n');
            var markers = [];

            for (var i = 1; i < lines.length; i++) {
                var values = lines[i].split(',');
                var 위치명 = values[0];
                var 위도 = parseFloat(values[1]);
                var 경도 = parseFloat(values[2]);

                var latlng = new naver.maps.LatLng(위도, 경도);

                var markerOptions = {
                    position: latlng,
                    map: map,
                    content: '<div style="padding:5px;">' + 위치명 + '</div>'
                };

                var marker = new naver.maps.Marker(markerOptions);
                markers.push(marker);
            }

            var oms = new OverlappingMarkerSpiderfier(map, { markersWontMove: true, markersWontHide: true });

            var clusterer = new MarkerClusterer({
                map: map,
                markers: markers,
                disableClickZoom: true,
                gridSize: 100,
                minClusterSize: 2,
                styles: [{
                    width: 36,
                    height: 36,
                    anchorIcon: [18, 36],
                    textSize: 12,
                    textColor: '#fff',
                    anchorText: [0, 0]
                }]
            });

            for (var i = 0; i < markers.length; i++) {
                oms.addMarker(markers[i]);
            }
        }


        loadCSV('대피소.csv', parseCSVAndCreateMarkers);
    </script>
</body>
</html>
